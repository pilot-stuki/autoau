# AutoAU - Автоматизированное управление переключателями

Оптимизированное приложение для авторизации пользователей на сайте и управления переключателями с минимальным использованием ресурсов.

## Особенности

- Оптимизация для работы в среде с ограниченными ресурсами (GitHub Codespace)
- Интеллектуальное управление сессиями для сокращения повторных авторизаций
- Адаптивное расписание проверок в зависимости от нагрузки на систему
- Система ротации и сжатия логов для экономии дискового пространства
- Надежная обработка ошибок с механизмом повторных попыток
- Оптимизированная работа с браузером для минимизации потребления памяти
- Поддержка параллельной и последовательной обработки аккаунтов

## Архитектура

Приложение построено на основе модульной архитектуры с четким разделением ответственности:

### Ключевые сервисы

- **Resource Management Service** - мониторинг и управление системными ресурсами
- **Browser Management Service** - управление браузерами и драйверами
- **Session Management Service** - управление сессиями пользователей
- **Error Handling Service** - стандартизированная обработка ошибок
- **Automation Service** - логика авторизации и управления переключателем

### Координаторы

- **Main Application** - точка входа для прямого запуска
- **Service Wrapper** - интерфейс для взаимодействия с сервисами

## Требования

- Python 3.7+
- Chrome или Chromium
- ChromeDriver (устанавливается автоматически скриптом `install_chromedriver.sh`)
- Пакеты из `requirements.txt`

## Установка

1. Установите Python 3.7+ и Google Chrome/Chromium
2. Клонируйте репозиторий
3. Установите зависимости:
```bash
pip install -r requirements.txt
```
4. Установите ChromeDriver:
```bash
./install_chromedriver.sh
```

## Настройка

1. Создайте или отредактируйте файл `users.txt` с учетными данными пользователей (формат: `email password` по одной паре на строку)
2. Настройте `config.yaml` по необходимости

## Использование

### Базовый запуск
```bash
python main.py
```

### Тестовый режим (одиночный запуск с первым аккаунтом)
```bash
python main.py --test-mode
```

### Проверка состояния без изменения
```bash
python main.py --check
```

### Обработка конкретного аккаунта
```bash
python main.py --account email@example.com
```

### Режим отладки
```bash
python main.py --debug
```

### Параллельный режим (не рекомендуется для ограниченных ресурсов)
```bash
python main.py --parallel
```

### Запуск в фоновом режиме
```bash
./restartService.sh
```

## Оптимизации для GitHub Codespace

Приложение автоматически определяет запуск в GitHub Codespace и активирует режим экономии ресурсов:
- Автоматический выбор последовательного выполнения
- Уменьшение количества проверок в рамках одного цикла
- Оптимизированные настройки браузера
- Увеличенные интервалы между циклами проверок
- Активное управление памятью и принудительная очистка

## Логирование

Все логи сохраняются в директории `logs` с ежедневными поддиректориями:
- `autoau.log` - основной лог операций
- `error.log` - записи только об ошибках
- `debug.log` - подробные отладочные логи

Настроена ротация и сжатие старых логов для экономии места.

## Тестирование

Проект включает набор модульных тестов для проверки корректности работы сервисов:

### Запуск всех тестов
```bash
cd autoau
python -m tests.run_tests
```

### Запуск конкретного теста
```bash
python -m tests.run_tests tests.test_resource_manager.TestResourceManager.test_singleton_pattern
```

### Запуск с шаблоном имени
```bash
python -m tests.run_tests -p "test_*singleton*"
```

### Структура тестов:
- `tests/test_resource_manager.py` - тесты сервиса управления ресурсами
- `tests/test_session_service.py` - тесты сервиса управления сессиями
- `tests/test_automation_service.py` - тесты сервиса автоматизации
- `tests/test_error_service.py` - тесты сервиса обработки ошибок

## Подсказки по эффективному использованию

1. Для экономии ресурсов используйте последовательный режим (`--parallel` не указан)
2. Установите большие интервалы проверки (по умолчанию 30-90 минут)
3. Перед долгосрочным запуском проверьте работоспособность с помощью `--test-mode`
4. Проверяйте текущее состояние переключателей с помощью `--check` 